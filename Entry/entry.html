<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Solana Fee Calculator</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
            rel="stylesheet"
        />
    </head>
    <body
        class="bg-gray-900 text-white font-inter min-h-screen flex items-center justify-center p-4"
    >
        <div class="bg-gray-800 p-6 rounded-xl shadow-2xl w-full max-w-md">
            <h1 class="text-2xl font-bold mb-6 text-center text-blue-400">
                SOL-Fee For Entry
            </h1>

            <div class="space-y-4">
                <!-- Wallet Balance Container -->
                <div
                    id="walletBalanceContainer"
                    class="bg-gray-700 p-3 rounded-md text-center mb-4"
                >
                    <span class="block text-sm text-gray-400 mb-1"
                        >Wallet 1 Balance</span
                    >
                    <span
                        id="walletBalanceDisplay"
                        class="text-2xl font-bold text-green-400"
                        >Loading...</span
                    >
                    <span
                        id="walletBalanceUSD"
                        class="block text-sm text-gray-400 mt-1"
                        >Loading...</span
                    >
                </div>

                <!-- Price Info -->
                <div id="priceInfo" class="text-sm text-gray-400 text-center">
                    1 SOL = $<span id="solPrice">-</span>
                </div>

                <!-- Fee Level Buttons -->
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2"
                        >Fee Level (SOL)</label
                    >
                    <div class="grid grid-cols-4 gap-2">
                        <button
                            data-fee="0.0005"
                            class="fee-btn bg-green-600 hover:bg-green-700 p-2 rounded-md w-full"
                        >
                            0.0005
                        </button>
                        <button
                            data-fee="0.001"
                            class="fee-btn bg-yellow-600 hover:bg-yellow-700 p-2 rounded-md w-full"
                        >
                            0.001
                        </button>
                        <button
                            data-fee="0.0015"
                            class="fee-btn bg-orange-600 hover:bg-orange-700 p-2 rounded-md w-full"
                        >
                            0.0015
                        </button>
                        <button
                            data-fee="0.01"
                            class="fee-btn bg-red-600 hover:bg-red-700 p-2 rounded-md w-full"
                        >
                            0.01
                        </button>
                    </div>

                    <!-- x2 Fee Checkbox -->
                    <div class="flex items-center justify-center mt-2">
                        <label class="flex items-center">
                            <input
                                type="checkbox"
                                id="feeMultiplierCheckbox"
                                class="mr-2"
                            />
                            <span class="text-sm">x2 Fee</span>
                        </label>
                    </div>
                </div>

                <!-- Result Display -->
                <div id="result" class="mt-4 text-center hidden">
                    <p class="text-lg">Remaining Balance:</p>
                    <p>
                        <span
                            id="remainingBalance"
                            class="font-bold text-green-400"
                        ></span>
                        SOL
                    </p>
                    <p>
                        <span
                            id="remainingBalanceUSD"
                            class="font-bold text-green-400"
                        ></span>
                        USD
                    </p>
                    <p>
                        <span
                            id="remainingBalanceIDR"
                            class="font-bold text-green-400"
                        ></span>
                        IDR
                    </p>
                </div>
            </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const RPC_ENDPOINTS = [
                    'https://api.mainnet-beta.solana.com',
                    'https://solana-mainnet.phantom.app',
                    'https://rpc.ankr.com/solana',
                    'https://solana-rpc.publicnode.com',
                ];

                const WALLET_ADDRESS =
                    '3MWedknEBbLNzv8ZcpPf5FJKE7AhAvGhwW8RuEZy11i7';
                const walletBalanceDisplay = document.getElementById(
                    'walletBalanceDisplay'
                );
                const walletBalanceUSD =
                    document.getElementById('walletBalanceUSD');
                const solPriceSpan = document.getElementById('solPrice');
                const feeButtons = document.querySelectorAll('.fee-btn');
                const feeMultiplierCheckbox = document.getElementById(
                    'feeMultiplierCheckbox'
                );
                const resultDiv = document.getElementById('result');
                const remainingBalanceSpan =
                    document.getElementById('remainingBalance');
                const remainingBalanceUSD = document.getElementById(
                    'remainingBalanceUSD'
                );
                const remainingBalanceIDR = document.getElementById(
                    'remainingBalanceIDR'
                );

                let solPrice = 0;
                let currentBalance = 0;

                // Fetch SOL Price
                async function fetchSolPrice() {
                    try {
                        const response = await fetch(
                            'https://api.coingecko.com/api/v3/simple/price?ids=solana&vs_currencies=usd'
                        );
                        const data = await response.json();
                        solPrice = data.solana.usd;
                        solPriceSpan.textContent = solPrice.toFixed(2);
                    } catch (error) {
                        console.error('Price fetch error:', error);
                        solPriceSpan.textContent = 'Error';
                    }
                }

                // Fetch Wallet Balance
                async function fetchWalletBalance() {
                    for (let endpoint of RPC_ENDPOINTS) {
                        try {
                            const connection = new solanaWeb3.Connection(
                                endpoint,
                                'confirmed'
                            );
                            const publicKey = new solanaWeb3.PublicKey(
                                WALLET_ADDRESS
                            );
                            const balance = await connection.getBalance(
                                publicKey
                            );
                            currentBalance =
                                balance / solanaWeb3.LAMPORTS_PER_SOL;

                            // Tampilkan saldo dalam SOL
                            walletBalanceDisplay.textContent = `${currentBalance.toFixed(
                                4
                            )} SOL`;

                            // Hitung dan tampilkan saldo dalam USD
                            const balanceUSD = currentBalance * solPrice;
                            walletBalanceUSD.textContent = `$${balanceUSD.toFixed(
                                2
                            )} USD`;

                            return;
                        } catch (error) {
                            console.error(
                                `Failed with endpoint ${endpoint}:`,
                                error
                            );
                        }
                    }
                    walletBalanceDisplay.textContent = 'Error';
                    walletBalanceUSD.textContent = 'Error';
                }

                // Initial calls
                fetchSolPrice();
                fetchWalletBalance();

                // Fee Selection
                feeButtons.forEach((button) => {
                    button.addEventListener('click', () => {
                        // Hapus styling dari semua tombol
                        feeButtons.forEach((btn) => {
                            btn.classList.remove(
                                'ring-4',
                                'ring-white',
                                'opacity-100'
                            );
                            btn.classList.add('opacity-50');
                        });

                        // Tambahkan styling ke tombol yang dipilih
                        button.classList.remove('opacity-50');
                        button.classList.add(
                            'ring-4',
                            'ring-white',
                            'opacity-100',
                            'scale-105'
                        );

                        // Ambil nilai fee yang dipilih
                        const selectedFee = parseFloat(button.dataset.fee);

                        // Periksa apakah checkbox x2 Fee aktif
                        const feeMultiplier = feeMultiplierCheckbox.checked
                            ? 2
                            : 1;

                        // Hitung total fee
                        const totalFee = selectedFee * feeMultiplier;

                        // Hitung sisa saldo
                        const remainingBalance = currentBalance - totalFee;

                        // Tampilkan sisa saldo dalam SOL
                        remainingBalanceSpan.textContent =
                            remainingBalance.toFixed(4);

                        // Hitung dan tampilkan sisa saldo dalam USD
                        const remainingBalanceUSDValue =
                            remainingBalance * solPrice;
                        remainingBalanceUSD.textContent = `$${remainingBalanceUSDValue.toFixed(
                            2
                        )}`;

                        // Hitung dan tampilkan sisa saldo dalam IDR (1 USD = 15.000 IDR)
                        const remainingBalanceIDRValue =
                            remainingBalanceUSDValue * 15000;
                        remainingBalanceIDR.textContent = `Rp ${remainingBalanceIDRValue.toLocaleString()}`;

                        // Tampilkan hasil
                        resultDiv.classList.remove('hidden');
                    });
                });

                // Tambahkan event listener untuk checkbox x2 Fee
                feeMultiplierCheckbox.addEventListener('change', () => {
                    // Ketika checkbox diubah, hitung ulang sisa saldo
                    const selectedButton =
                        document.querySelector('.fee-btn.ring-4');
                    if (selectedButton) {
                        selectedButton.click(); // Trigger click event pada tombol yang dipilih
                    }
                });
            });
        </script>
    </body>
</html>
